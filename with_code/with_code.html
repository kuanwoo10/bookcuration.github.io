<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>터미널 챗</title>
  <style>
    :root{ --bg:#0b1020; --panel:#0f172a; --ink:#e5e7eb; --dim:#94a3b8; --green:#22c55e; --cyan:#06b6d4; --danger:#ef4444; --border:#1f2937; }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#0a0f1e,#0d1530)}
    body{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; color:var(--ink); display:flex; align-items:center; justify-content:center; }
    .app{ width:min(920px, 100%); height:min(84vh, 820px); background:var(--panel); border:1px solid var(--border); border-radius:14px; box-shadow:0 18px 40px rgba(0,0,0,.35); display:flex; flex-direction:column; overflow:hidden; }
    .titlebar{ display:flex; align-items:center; justify-content:space-between; padding:10px 14px; border-bottom:1px solid var(--border); background:linear-gradient(180deg,#111827,#0f172a); }
    .dots{display:flex; gap:8px}.dot{width:10px;height:10px;border-radius:50%}.dot.red{background:#ef4444}.dot.yellow{background:#f59e0b}.dot.green{background:#22c55e}
    .title{font-weight:800; letter-spacing:.4px}.status{font-size:12px; color:var(--dim)}.status .on{color:var(--green)}
    .log{ flex:1; overflow-y:auto; padding:16px; background:repeating-linear-gradient(0deg, #0f172a, #0f172a 22px, #0e162d 22px, #0e162d 44px); }
    .line{display:flex; gap:10px; margin:6px 0; white-space:pre-wrap; word-break:break-word}
    .prompt{color:var(--green)} .user .prompt::after{content:"$";} .bot .prompt::after{content:"#";}
    .sys{justify-content:center; color:var(--dim); font-size:12px} .out{color:var(--ink)}
    .footer{border-top:1px solid var(--border); padding:10px 12px; background:#0d1326;}
    .bar{display:flex; align-items:center; gap:8px; background:#0b1224; border:1px solid var(--border); border-radius:10px; padding:8px 10px;}
    .ps1{color:var(--green); user-select:none}
    input[type="text"]{flex:1; background:transparent; border:0; outline:none; color:var(--ink); font:inherit; padding:4px 2px;}
    .hint{display:flex; gap:10px; margin-top:8px; color:var(--dim); font-size:12px}
    .chip{border:1px solid var(--border); padding:4px 8px; border-radius:999px; cursor:pointer}
    @media (max-width: 640px){ .ps1.printwrap{display:none} }
  </style>
</head>
<body>
  <div class="app" id="app">
    <div class="titlebar">
      <div style="display:flex; align-items:center; gap:10px">
        <div class="dots"><span class="dot red"></span><span class="dot yellow"></span><span class="dot green"></span></div>
        <div class="title">terminal-chat</div>
      </div>
      <div class="status"><span class="on">●</span> connected</div>
    </div>

    <div id="log" class="log" aria-live="polite"></div>

    <div class="footer">
      <div class="bar">
        <!-- 입력창은 항상 >> print(' ... ') 래핑 유지 -->
        <span class="ps1 printwrap" id="pre">&gt;&gt; print('</span>
        <input id="inp" type="text" autocomplete="off" placeholder="이름을 입력하세요" />
        <span class="ps1 printwrap" id="post">')</span>
      </div>
      <div class="hint">
        <span class="chip" data-fill="민수">민수</span>
        <span class="chip" data-fill="안녕?">안녕?</span>
        <span class="chip" data-fill="clear">clear</span>
        <span class="chip" data-fill="help">help</span>
      </div>
    </div>
  </div>

  <script>
    // ===== 상태 =====
    const log = document.getElementById('log');
    const inp = document.getElementById('inp');
    const pre = document.getElementById('pre');
    const post = document.getElementById('post');
    const state = { name: null, awaitingName: true };

    // 처음 질문
    pushLine({role:"bot", html:"너 이름이 뭐야?  <span class='dim'>(그냥 이름만 입력하면 돼요)</span>"});

    // ===== 유틸 =====
    function pushLine({role="bot", promptText=null, html=""}){
      const row = document.createElement('div');
      row.className = role === "sys" ? "line sys" : `line ${role}`;
      if(role === "sys"){
        row.textContent = html;
      }else{
        const p = document.createElement('span');
        p.className = 'prompt';
        const defaultPrompt =
          role === "user"
            ? (state.name ? `${state.name}@local:~` : "guest@local:~")
            : "term@host:~";
        p.textContent = promptText ?? defaultPrompt;
        const body = document.createElement('div');
        body.className = 'out';
        body.innerHTML = html;
        row.appendChild(p); row.appendChild(body);
      }
      log.appendChild(row);
      log.scrollTop = log.scrollHeight;
    }
    function esc(s){ return s.replace(/[&<>]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[c])); }

    // ===== 명령들 =====
    function cmdHelp(){
      pushLine({
        role:"bot",
        html: [
          "<span class='dim'>사용법</span>",
          "<br>1) 시작: 이름을 입력하면 위 대화창의 사용자 프롬프트가 <b>이름@local:~$</b> 로 바뀝니다.",
          "<br>2) 입력창은 계속 <b>&gt;&gt; print(' ... ')</b> 형식을 유지합니다.",
          "<br>3) <b>clear</b> 로 화면 지우기, <b>help</b> 로 도움말."
        ].join("")
      });
    }

    // ===== 입력 처리 =====
    async function handleInputSubmit(){
      const text = inp.value.trim();
      if(!text) return;
      inp.value = "";
      pushLine({role:"user", html: esc(text)});

      // clear / help
      if(text.toLowerCase() === "clear"){
        log.innerHTML = "";
        pushLine({role:"bot", html:"화면을 지웠어요."});
        if(!state.name){
          pushLine({role:"bot", html:"너 이름이 뭐야?"});
          inp.placeholder = "이름을 입력하세요";
          state.awaitingName = true;
        }
        return;
      }
      if(text.toLowerCase() === "help"){ cmdHelp(); return; }

      // 1) 이름 단계: 입력 그대로 이름으로 사용 (입력창 래핑은 계속 유지)
      if(state.awaitingName){
        const name = text;
        state.name = name;
        state.awaitingName = false;
        inp.placeholder = "메시지를 입력하세요…";
        pushLine({role:"bot", html:`반가워요, <span class="cyan">${esc(name)}</span>! ${esc(name)}님에게 맞는 글귀를 추천해 줄게요. <br>마음에 드는 카테고리가 있을까요?  <br> "{{"우정, 사랑.</br>`});
        return;
      }
	  
	  // 3) 카테고리 입력 모드
      if(/사랑|우정/i.test(text)){
		
		return;
	  }

      // 기본 에코
      pushLine({role:"bot", html:`"${esc(text)}" 라고 하셨네요.`});
    }
	
	


    // ===== 이벤트 =====
    inp.addEventListener('keydown', (e)=>{
      if(e.key === "Enter"){
        e.preventDefault();
        handleInputSubmit();
      }
    });
    document.querySelectorAll('.chip').forEach(ch=>{
      ch.addEventListener('click', ()=>{
        inp.value = ch.getAttribute('data-fill');
        inp.focus();
      });
    });

    // 작은 강조 색
    const style = document.createElement('style');
    style.textContent = `.cyan{ color: ${getComputedStyle(document.documentElement).getPropertyValue('--cyan') || '#0ea5e9'} }`;
    document.head.appendChild(style);
  </script>
</body>
</html>
