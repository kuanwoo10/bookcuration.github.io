<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>텍스트 온 더 무브 | 코드로 소통하기</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600;800&display=swap" rel="stylesheet">

<style>
  :root{ --ink:#e5edff; --muted:#9fb4ff; --line:#1b2540; --bg:#0b1221; --panel:#0e1730; --accent:#83a1ff; --accent2:#ffdf6b }
  *{ box-sizing:border-box }
  html,body{ height:100% }
  body{
    margin:0; background:var(--bg); color:var(--ink);
    font-family:'Noto Sans KR', ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    display:flex; align-items:center; justify-content:center; padding:24px
  }
  .shell{ width:100%; max-width:960px }

  .hero{ color:#ffffff; text-align:center; margin:0 0 16px }
  .hero h1{ margin:0; font-size:clamp(24px,4.8vw,40px); font-weight:800 }
  .hero p{ margin:6px 0 0; color:#c9d6ff }

  /* terminal card */
  .term{ background:#0b1221; border:1px solid var(--line); border-radius:12px; overflow:hidden; }
  .term .hdr{ padding:10px 12px; border-bottom:1px solid var(--line); display:flex; gap:8px; align-items:center }
  .dot{ width:10px; height:10px; border-radius:50%; display:inline-block }
  .dot.r{ background:#ff5f57 } .dot.y{ background:#febc2e } .dot.g{ background:#28c840 }
  .term .title{ margin-left:8px; color:#cfe1ff; font-weight:700; font-size:14px }

  .term .out{ padding:14px 14px 6px; max-height:58vh; overflow:auto; line-height:1.7 }
  .term .form{ display:flex; gap:8px; align-items:center; padding:10px 14px; border-top:1px solid var(--line) }
  .term .ps1{ color:var(--accent) }
  .term .in{
    flex:1; background:var(--panel); color:var(--ink);
    border:1px solid #24335e; border-radius:8px; padding:10px 12px; font-size:16px;
  }

  .sys{ color:var(--muted) }
  .usr{ color:#c9f6dd }
  .hl { color:var(--accent2); font-weight:800 }
  a.link{ color:#7aa7ff; text-decoration:underline }

  .foot{ text-align:center; color:#9fb4ff; margin-top:12px; font-size:13px }
</style>
</head>
<body>
  <div class="shell">
    <header class="hero">
      <h1>코드로 소통하기</h1>
      <p>이름을 입력하고, 카테고리 <strong>[1, 2, 3, 4, 5, 6, 7]</strong> 중 하나를 숫자로 골라보세요.</p>
    </header>

    <!-- Terminal Chat -->
    <section id="terminal-chat" class="term" aria-label="터미널 채팅">
      <div class="hdr">
        <span class="dot r"></span><span class="dot y"></span><span class="dot g"></span>
        <span class="title">terminal-chat</span>
      </div>
      <div id="term-out" class="out" aria-live="polite"></div>
      <form id="term-form" class="form" autocomplete="off">
        <span id="ps1" class="ps1">guest@local:~$</span>
        <input id="term-input" class="in" type="text" placeholder="여기에 입력하고 Enter" />
      </form>
    </section>

    <div class="foot">팝업이 차단되면 챗에 뜨는 링크로 열어주세요.</div>
  </div>

<script>
(() => {
  // 새 창으로 열 페이지 경로 (현재 파일이 /with_code/ 안에 있을 때)
  const VIEW_URL = '../today_poem/view.html';

  const out   = document.getElementById('term-out');
  const form  = document.getElementById('term-form');
  const input = document.getElementById('term-input');
  const ps1   = document.getElementById('ps1');

  const scrollEnd = () => out.scrollTop = out.scrollHeight;
  const userPrompt = () => `${name || 'guest'}@local:~$`;
  const push = (who, html, cls) => {
    const div = document.createElement('div');
    div.innerHTML = `<span class="${cls}">${who}</span> ${html}`;
    out.appendChild(div); scrollEnd();
  };
  const bot = (html) => push('term@host:~#', html, 'sys');
  const me  = (html) => push(userPrompt(), html, 'usr');

  let state = 'askName';
  let name  = localStorage.getItem('btm_name') || '';

  function setPrompt(){ ps1.textContent = userPrompt(); }
  function start(){
    bot('너 이름이 뭐야?  <span class="sys">(그냥 이름만 입력하면 돼요)</span>');
    if(name){ // 저장된 이름 힌트
      bot(`이전에 <span class="hl">${name}</span> 라고 하셨어요. 그대로 쓰려면 Enter만 눌러도 돼요.`);
    }
    setPrompt(); input.focus();
  }

  function showCats(){
    bot(`반가워요, <span class="hl">${name}</span>! ${name}님에게 맞는 글귀를 추천해 줄게요.<br>
         마음에 드는 카테고리가 있을까요?<br>
         <span class="hl">[1, 2, 3, 4, 5, 6, 7]</span> 중 하나를 <strong>숫자</strong>로 입력해 주세요.`);
  }

  function openViewer(cat){
    const url = `${VIEW_URL}?c=${encodeURIComponent(cat)}&auto=random&n=${encodeURIComponent(name)}`;
    const w = window.open(url, '_blank', 'noopener');
    if(!w){
      bot(`팝업이 차단된 것 같아요. 아래 링크를 눌러 열어주세요.<br>
           <a class="link" target="_blank" rel="noopener" href="${url}">새 창으로 열기</a>`);
    }
  }

  form.addEventListener('submit', (e)=>{
    e.preventDefault();
    let val = input.value.trim();
    input.value = '';

    if(state === 'askName'){
      if(!val && name){ // 저장된 이름 사용
        me(name);
      } else if(!val){
        bot('이름을 입력해 주세요.');
        return;
      } else {
        name = val; me(name);
      }
      localStorage.setItem('btm_name', name);
      setPrompt();
      state = 'askCat';
      showCats();
      return;
    }

    // state === 'askCat'
    me(val);
    if(!/^[1-7]$/.test(val)){
      bot('1부터 7 사이의 숫자만 입력해 주세요. 예) 1');
      return;
    }
    bot(`<span class="hl">${val}</span>을(를) 선택하셨네요. <span class="hl">${val}</span>에 맞는 글귀를 추천해드릴게요!`);
    openViewer(val);
    showCats(); // 계속 다른 숫자도 입력할 수 있게 유지
  });

  start();
})();
</script>
</body>
</html>
